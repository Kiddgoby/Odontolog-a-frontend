<div class="content">
    <div class="page-header">
        <h1>Tratamientos</h1>
        <button class="btn-add" (click)="abrirFormulario()">
            <i class="fa-solid fa-plus"></i> Añadir Tratamiento
        </button>
    </div>

    <div class="filters">
        <input type="text" placeholder="Buscar por nombre o descripción..." [(ngModel)]="searchTerm" />
        <select [(ngModel)]="selectedCategory">
            <option *ngFor="let c of categorias" [value]="c">{{ c }}</option>
        </select>
    </div>

    <div class="treatments-grid">
        <div class="card" *ngFor="let t of tratamientosFiltrados">
            <div class="card-header">
                <h3>{{ t.nombre }}</h3>
                <span class="category-tag">{{ t.categoria }}</span>
            </div>

            <p class="card-description">{{ t.descripcion }}</p>

            <div class="card-footer">
                <span class="duration-box">
                    <i class="fa-regular fa-clock"></i> {{ t.duracion }} min
                </span>
                <span class="price-box">€{{ t.precio }}</span>
            </div>

            <div class="card-actions">
                <button class="btn-small btn-edit" (click)="editar(t)">Editar</button>
                <button class="btn-small btn-delete" (click)="eliminar(t.id)">Eliminar</button>
            </div>
        </div>
    </div>
</div>

<!-- REAL MODAL POPUP -->
<div class="modal-backdrop" *ngIf="showForm" (click)="cerrarFormulario()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>{{ isEditing ? 'Editar' : 'Nuevo' }} Tratamiento</h2>
            <button class="btn-close" (click)="cerrarFormulario()"
                style="background:none; border:none; cursor:pointer; font-size:1.2rem;">&times;</button>
        </div>

        <div class="modal-body">
            <form (submit)="guardar()" id="treatmentForm">
                <div class="form-group">
                    <label>Nombre del Servicio</label>
                    <input type="text" [(ngModel)]="currentTratamiento.nombre" name="nombre" class="form-control"
                        required />
                </div>

                <div class="form-group">
                    <label>Categoría</label>
                    <select [(ngModel)]="currentTratamiento.categoria" name="categoria" class="form-control">
                        <option *ngFor="let c of categorias.slice(1)" [value]="c">{{ c }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Descripción</label>
                    <textarea [(ngModel)]="currentTratamiento.descripcion" name="descripcion" class="form-control"
                        rows="3"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Duración (min)</label>
                        <input type="number" [(ngModel)]="currentTratamiento.duracion" name="duracion"
                            class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Precio (€)</label>
                        <input type="number" [(ngModel)]="currentTratamiento.precio" name="precio" class="form-control"
                            required />
                    </div>
                </div>
            </form>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn-cancel" (click)="cerrarFormulario()">Cancelar</button>
            <button type="submit" form="treatmentForm" class="btn-save">
                {{ isEditing ? 'Actualizar' : 'Guardar' }}
            </button>
        </div>
    </div>
</div>